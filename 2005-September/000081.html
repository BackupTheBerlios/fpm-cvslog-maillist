<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [fpm-cvslog] fpm/include Makefile,NONE,1.1 fixedpointmath.h,NONE,1.1 fixedpointmathcode.h,NONE,1.1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fpm-cvslog/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:fpm-cvslog%40lists.berlios.de?Subject=Re%3A%20%5Bfpm-cvslog%5D%20fpm/include%20Makefile%2CNONE%2C1.1%20fixedpointmath.h%2CNONE%2C1.1%20fixedpointmathcode.h%2CNONE%2C1.1&In-Reply-To=%3C200509130344.j8D3il124552%40bat.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000080.html">
   <LINK REL="Next"  HREF="000082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[fpm-cvslog] fpm/include Makefile,NONE,1.1 fixedpointmath.h,NONE,1.1 fixedpointmathcode.h,NONE,1.1</H1>
    <B>ivop</B> 
    <A HREF="mailto:fpm-cvslog%40lists.berlios.de?Subject=Re%3A%20%5Bfpm-cvslog%5D%20fpm/include%20Makefile%2CNONE%2C1.1%20fixedpointmath.h%2CNONE%2C1.1%20fixedpointmathcode.h%2CNONE%2C1.1&In-Reply-To=%3C200509130344.j8D3il124552%40bat.berlios.de%3E"
       TITLE="[fpm-cvslog] fpm/include Makefile,NONE,1.1 fixedpointmath.h,NONE,1.1 fixedpointmathcode.h,NONE,1.1">nobody at sheep.berlios.de
       </A><BR>
    <I>Tue Sep 13 05:44:47 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000080.html">[fpm-cvslog] fpm/include - New directory
</A></li>
        <LI>Next message: <A HREF="000082.html">[fpm-cvslog] fpm/misc - New directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81">[ date ]</a>
              <a href="thread.html#81">[ thread ]</a>
              <a href="subject.html#81">[ subject ]</a>
              <a href="author.html#81">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/fpm/fpm/include
In directory sheep:/tmp/cvs-serv29544

Added Files:
	Makefile fixedpointmath.h fixedpointmathcode.h 
Log Message:
initial check in



--- NEW FILE: Makefile ---
#
# Fixed Point Math Macro Library - Makefile
#
# (C)opyright 2005 by Ivo van Poorten
# Licensed under version 2 of the GPL
#
# $Id: Makefile,v 1.1 2005/09/13 03:44:44 ivop Exp $
#

include ../config.mak

.PHONY:	clean
clean:
	rm -f fixedpointmathlut.h

.PHONY:	distclean
distclean:		clean
	rm -f *~


--- NEW FILE: fixedpointmath.h ---
/* ------------------------------------------------------------------------- */

/*
 * Fixed Point Math Macro Library
 *
 * (C)opyright 2005 by Ivo van Poorten
 * Licensed under version 2 of the GPL
 *
 * $Id: fixedpointmath.h,v 1.1 2005/09/13 03:44:44 ivop Exp $
 *
 */

/* ------------------------------------------------------------------------- */

#ifndef __FIXEDPOINTMATH_H__
#define __FIXEDPOINTMATH_H__

/* ------------------------------------------------------------------------- */

#define __FPM_VERSION__         0.30
#define __FPM_VERSION_MAJOR__   0
#define __FPM_VERSION_MINOR__   30
#define __FPM_VERSION_RELEASE__ cvs

/* ------------------------------------------------------------------------- */

#include &lt;inttypes.h&gt;
#include &quot;fixedpointmathcode.h&quot;

/* ------------------------------------------------------------------------- */

/* int to fixed point */

#define itofp8p8(x)     _itofp8p8(x)
#define itofp24p8(x)    _itofp24p8(x)
#define itofp16p16(x)   _itofp16p16(x)
#define itofp8p24(x)    _itofp8p24(x)
#define itoufp8p8(x)    _itoufp8p8(x)
#define itoufp24p8(x)   _itoufp24p8(x)
#define itoufp16p16(x)  _itoufp16p16(x)
#define itoufp8p24(x)   _itoufp8p24(x)

/* float to fixed point */

#define ftofp8p8(x)     _ftofp8p8(x)
#define ftofp24p8(x)    _ftofp24p8(x)
#define ftofp16p16(x)   _ftofp16p16(x)
#define ftofp8p24(x)    _ftofp8p24(x)
#define ftoufp8p8(x)    _ftoufp8p8(x)
#define ftoufp24p8(x)   _ftoufp24p8(x)
#define ftoufp16p16(x)  _ftoufp16p16(x)
#define ftoufp8p24(x)   _ftoufp8p24(x)

/* double to fixed point */

#define dtofp8p8(x)     _dtofp8p8(x)
#define dtofp24p8(x)    _dtofp24p8(x)
#define dtofp16p16(x)   _dtofp16p16(x)
#define dtofp8p24(x)    _dtofp8p24(x)
#define dtoufp8p8(x)    _dtoufp8p8(x)
#define dtoufp24p8(x)   _dtoufp24p8(x)
#define dtoufp16p16(x)  _dtoufp16p16(x)
#define dtoufp8p24(x)   _dtoufp8p24(x)

/* fixed point to int */

#define fp8p8toi(x)     _fp8p8toi(x)
#define fp24p8toi(x)    _fp24p8toi(x)
#define fp16p16toi(x)   _fp16p16toi(x)
#define fp8p24toi(x)    _fp8p24toi(x)
#define ufp8p8toi(x)    _ufp8p8toi(x)
#define ufp24p8toi(x)   _ufp24p8toi(x)
#define ufp16p16toi(x)  _ufp16p16toi(x)
#define ufp8p24toi(x)   _ufp8p24toi(x)

/* fixed point to float */

#define fp8p8tof(x)     _fp8p8tof(x)
#define fp24p8tof(x)    _fp24p8tof(x)
#define fp16p16tof(x)   _fp16p16tof(x)
#define fp8p24tof(x)    _fp8p24tof(x)
#define ufp8p8tof(x)    _ufp8p8tof(x)
#define ufp24p8tof(x)   _ufp24p8tof(x)
#define ufp16p16tof(x)  _ufp16p16tof(x)
#define ufp8p24tof(x)   _ufp8p24tof(x)

/* fixed point to double */

#define fp8p8tod(x)     _fp8p8tod(x)
#define fp24p8tod(x)    _fp24p8tod(x)
#define fp16p16tod(x)   _fp16p16tod(x)
#define fp8p24tod(x)    _fp8p24tod(x)
#define ufp8p8tod(x)    _ufp8p8tod(x)
#define ufp24p8tod(x)   _ufp24p8tod(x)
#define ufp16p16tod(x)  _ufp16p16tod(x)
#define ufp8p24tod(x)   _ufp8p24tod(x)

/* multiplication (x*y) */

#define mulfp8p8(x,y)    _mulfp8p8(x,y)
#define mulfp24p8(x,y)   _mulfp24p8(x,y)
#define mulfp16p16(x,y)  _mulfp16p16(x,y)
#define mulfp8p24(x,y)   _mulfp8p24(x,y)
#define mulufp8p8(x,y)   _mulufp8p8(x,y)
#define mulufp24p8(x,y)  _mulufp24p8(x,y)
#define mulufp16p16(x,y) _mulufp16p16(x,y)
#define mulufp8p24(x,y)  _mulufp8p24(x,y)

/* division (x/y) */

#define divfp8p8(x,y)    _divfp8p8(x,y)
#define divfp24p8(x,y)   _divfp24p8(x,y)
#define divfp16p16(x,y)  _divfp16p16(x,y)
#define divfp8p24(x,y)   _divfp8p24(x,y)
#define divufp8p8(x,y)   _divufp8p8(x,y)
#define divufp24p8(x,y)  _divufp24p8(x,y)
#define divufp16p16(x,y) _divufp16p16(x,y)
#define divufp8p24(x,y)  _divufp8p24(x,y)

/* square root */

/* Hmm, might need to move this stuff to ....code and have one more level
 * of _ so here it's just #define bla(x) _bla(x) no matter what, especially
 * when the other functions get LUT support too and/or more functions
 * are added.
 */

#if defined(__FPM_ENABLE_ALL_LUT__) || defined(__FPM_ENABLE_SQRT_LUT__)

#define sqrtufp8p8(x)   _sqrtufp8p8lut(x)
#define sqrtufp24p8(x)  _sqrtufp24p8lut(x)
#define sqrtufp16p16(x) _sqrtufp16p16lut(x)
#define sqrtufp8p24(x)  _sqrtufp8p24lut(x)
#define sqrtfp8p8(x)    _sqrtfp8p8lut(x)
#define sqrtfp24p8(x)   _sqrtfp24p8lut(x)
#define sqrtfp16p16(x)  _sqrtfp16p16lut(x)
#define sqrtfp8p24(x)   _sqrtfp8p24lut(x)

#else

#define sqrtufp8p8(x)   _sqrtufp8p8(x)
#define sqrtufp24p8(x)  _sqrtufp24p8(x)
#define sqrtufp16p16(x) _sqrtufp16p16(x)
#define sqrtufp8p24(x)  _sqrtufp8p24(x)
#define sqrtfp8p8(x)    _sqrtfp8p8(x)
#define sqrtfp24p8(x)   _sqrtfp24p8(x)
#define sqrtfp16p16(x)  _sqrtfp16p16(x)
#define sqrtfp8p24(x)   _sqrtfp8p24(x)

#endif

/* exponential function e^x for x&gt;=0 */

#if defined(__FPM_ENABLE_ALL_LUT__) || defined(__FPM_ENABLE_EXP_LUT__)

#define expufp8p8(x)   _expufp8p8lut(x)
#define expufp24p8(x)  _expufp24p8lut(x)
#define expufp16p16(x) _expufp16p16lut(x)
#define expufp8p24(x)  _expufp8p24lut(x)
#define expfp8p8(x)    _expfp8p8lut(x)
#define expfp24p8(x)   _expfp24p8lut(x)
#define expfp16p16(x)  _expfp16p16lut(x)
#define expfp8p24(x)   _expfp8p24lut(x)

#else

#define expfp8p8(x)     _expfp8p8(x)
#define expfp24p8(x)    _expfp24p8(x)
#define expfp16p16(x)   _expfp16p16(x)
#define expfp8p24(x)    _expfp8p24(x)
#define expufp8p8(x)    _expufp8p8(x)
#define expufp24p8(x)   _expufp24p8(x)
#define expufp16p16(x)  _expufp16p16(x)
#define expufp8p24(x)   _expufp8p24(x)

#endif

/* natural logarithm ln(x) */

#if defined(__FPM_ENABLE_ALL_LUT__) || defined(__FPM_ENABLE_LN_LUT__)

#define lnufp8p8(x)   _lnufp8p8lut(x)
#define lnufp24p8(x)  _lnufp24p8lut(x)
#define lnufp16p16(x) _lnufp16p16lut(x)
#define lnufp8p24(x)  _lnufp8p24lut(x)
#define lnfp8p8(x)    _lnfp8p8lut(x)
#define lnfp24p8(x)   _lnfp24p8lut(x)
#define lnfp16p16(x)  _lnfp16p16lut(x)
#define lnfp8p24(x)   _lnfp8p24lut(x)

#else

#define lnfp8p8(a)      _lnfp8p8(a)
#define lnfp24p8(a)     _lnfp24p8(a)
#define lnfp16p16(a)    _lnfp16p16(a)
#define lnfp8p24(a)     _lnfp8p24(a)
#define lnufp8p8(a)     _lnufp8p8(a)
#define lnufp24p8(a)    _lnufp24p8(a)
#define lnufp16p16(a)   _lnufp16p16(a)
#define lnufp8p24(a)    _lnufp8p24(a)

#endif

/* power function  pow(x,y) = x^y */

#define powfp8p8(x,y)    _powfp8p8(x,y)
#define powfp24p8(x,y)   _powfp24p8(x,y)
#define powfp16p16(x,y)  _powfp16p16(x,y)
#define powfp8p24(x,y)   _powfp8p24(x,y)
#define powufp8p8(x,y)   _powufp8p8(x,y)
#define powufp24p8(x,y)  _powufp24p8(x,y)
#define powufp16p16(x,y) _powufp16p16(x,y)
#define powufp8p24(x,y)  _powufp8p24(x,y)

/* ------------------------------------------------------------------------- */

#endif

/* ------------------------------------------------------------------------- */


--- NEW FILE: fixedpointmathcode.h ---
/* ------------------------------------------------------------------------- */

/* DO NOT INCLUDE THIS FILE DIRECTLY! ALWAYS INCLUDE fixedpointmath.h only!! */

/*
 * Fixed Point Math Macro Library
 *
 * This file contains the actual implementations of the functions.
 *
 * (C)opyright 2005 by Ivo van Poorten
 * Licensed under version 2 of the GPL
 *
 * $Id: fixedpointmathcode.h,v 1.1 2005/09/13 03:44:44 ivop Exp $
 *
 */

/* ------------------------------------------------------------------------- */

#ifndef __FIXEDPOINTMATHCODE_H__
#define __FIXEDPOINTMATHCODE_H__

/* ------------------------------------------------------------------------- */

#include &lt;inttypes.h&gt;

/* ------------------------------------------------------------------------- */

/* signed */

typedef int16_t fp8p8_t;
typedef int32_t fp24p8_t;
typedef int32_t fp16p16_t;
typedef int32_t fp8p24_t;

/* unsigned */

typedef uint16_t ufp8p8_t;
typedef uint32_t ufp24p8_t;
typedef uint32_t ufp16p16_t;
typedef uint32_t ufp8p24_t;

/* ------------------------------------------------------------------------- */

#if defined(__FPM_ENABLE_ALL_LUT__) || defined(__FPM_ENABLE_SQRT_LUT__)
#include &quot;fixedpointmathlut.h&quot;
#endif

/* ------------------------------------------------------------------------- */

#if defined(__INTEL_COMPILER)
#pragma warning(disable:187)    /* '=' where '==' may have been intended */
#endif

/* ------------------------------------------------------------------------- */

/* CONVERSION */

/* int to fixed point */

#define _itofp8p8(x)    ( (int16_t)  (x) &lt;&lt; 8 )
#define _itofp24p8(x)   ( (int32_t)  (x) &lt;&lt; 8 )
#define _itofp16p16(x)  ( (int32_t)  (x) &lt;&lt; 16 )
#define _itofp8p24(x)   ( (int32_t)  (x) &lt;&lt; 24 )
#define _itoufp8p8(x)   ( (uint16_t) (x) &lt;&lt; 8 )
#define _itoufp24p8(x)  ( (uint32_t) (x) &lt;&lt; 8 )
#define _itoufp16p16(x) ( (uint32_t) (x) &lt;&lt; 16 )
#define _itoufp8p24(x)  ( (uint32_t) (x) &lt;&lt; 24 )

/* float to fixed point */

#define _ftofp8p8(x)    ( (fp8p8_t)    ((x) * 256.0) )
#define _ftofp24p8(x)   ( (fp24p8_t)   ((x) * 256.0) )
#define _ftofp16p16(x)  ( (fp16p16_t)  ((x) * 65536.0) )
#define _ftofp8p24(x)   ( (fp8p24_t)   ((x) * 16777216.0) )
#define _ftoufp8p8(x)   ( (ufp8p8_t)   ((x) * 256.0) )
#define _ftoufp24p8(x)  ( (ufp24p8_t)  ((x) * 256.0) )
#define _ftoufp16p16(x) ( (ufp16p16_t) ((x) * 65536.0) )
#define _ftoufp8p24(x)  ( (ufp8p24_t)  ((x) * 16777216.0) )

/* double to fixed point */

#define _dtofp8p8(x)    _ftofp8p8(x)
#define _dtofp24p8(x)   _ftofp24p8(x)
#define _dtofp16p16(x)  _ftofp16p16(x)
#define _dtofp8p24(x)   _ftofp8p24(x)
#define _dtoufp8p8(x)   _ftoufp8p8(x)
#define _dtoufp24p8(x)  _ftoufp24p8(x)
#define _dtoufp16p16(x) _ftoufp16p16(x)
#define _dtoufp8p24(x)  _ftoufp8p24(x)

/* fixed point to int */

#define _fp8p8toi(x)    ( (x) &gt;&gt; 8 )
#define _fp24p8toi(x)   ( (x) &gt;&gt; 8 )
#define _fp16p16toi(x)  ( (x) &gt;&gt; 16 )
#define _fp8p24toi(x)   ( (x) &gt;&gt; 24 )
#define _ufp8p8toi(x)   _fp8p8toi(x)
#define _ufp24p8toi(x)  _fp24p8toi(x)
#define _ufp16p16toi(x) _fp16p16toi(x)
#define _ufp8p24toi(x)  _fp8p24toi(x)

/* fixed point to float */

#define _fp8p8tof(x)    ( (float) (x) / 256.0 )
#define _fp24p8tof(x)   ( (float) (x) / 256.0 )
#define _fp16p16tof(x)  ( (float) (x) / 65536.0 )
#define _fp8p24tof(x)   ( (float) (x) / 16777216.0 )
#define _ufp8p8tof(x)   _fp8p8tof(x)
#define _ufp24p8tof(x)  _fp24p8tof(x)
#define _ufp16p16tof(x) _fp16p16tof(x)
#define _ufp8p24tof(x)  _fp8p24tof(x)

/* fixed point to double */

#define _fp8p8tod(x)    ( (double) (x) / 256.0 )
#define _fp24p8tod(x)   ( (double) (x) / 256.0 )
#define _fp16p16tod(x)  ( (double) (x) / 65536.0 )
#define _fp8p24tod(x)   ( (double) (x) / 16777216.0 )
#define _ufp8p8tod(x)   _fp8p8tod(x)
#define _ufp24p8tod(x)  _fp24p8tod(x)
#define _ufp16p16tod(x) _fp16p16tod(x)
#define _ufp8p24tod(x)  _fp8p24tod(x)

/* fixed point to fixed point */

#define _fp8p8tofp8p8(x)                        (x)
#define _fp8p8tofp24p8(x)         ((fp24p8_t)   (x))
#define _fp8p8tofp16p16(x)      ( ((fp16p16_t)  (x)) &lt;&lt;  8 )
#define _fp8p8tofp8p24(x)       ( ((fp8p24_t)   (x)) &lt;&lt; 16 )
#define _ufp8p8toufp8p8(x)                      (x)
#define _ufp8p8toufp24p8(x)       ((ufp24p8_t)  (x))
#define _ufp8p8toufp16p16(x)    ( ((ufp16p16_t) (x)) &lt;&lt;  8 )
#define _ufp8p8toufp8p24(x)     ( ((ufp8p24_t)  (x)) &lt;&lt; 16 )

#define _fp24p8tofp8p8(x)         ((fp8p8_t)    (x))
#define _fp24p8tofp24p8(x)                      (x)
#define _fp24p8tofp16p16(x)     ( ((fp16p16_t)  (x)) &lt;&lt; 8 )
#define _fp24p8tofp8p24(x)      ( ((fp8p24_t)   (x)) &lt;&lt; 16)
#define _ufp24p8toufp8p8(x)       ((ufp8p8_t)   (x))
#define _ufp24p8toufp24p8(x)                    (x)
#define _ufp24p8toufp16p16(x)   ( ((ufp16p16_t) (x)) &lt;&lt; 8 )
#define _ufp24p8toufp8p24(x)    ( ((ufp8p24_t)  (x)) &lt;&lt; 16)

#define _fp16p16tofp8p8(x)      ( (fp8p8_t)    ((x)  &gt;&gt; 8 ) )
#define _fp16p16tofp24p8(x)     ( (fp24p8_t)   ((x)  &gt;&gt; 8 ) )
#define _fp16p16tofp16p16(x)                    (x)
#define _fp16p16tofp8p24(x)     ( (fp8p24_t)   ((x)  &lt;&lt; 8 ) )
#define _ufp16p16toufp8p8(x)    ( (ufp8p8_t)   ((x)  &gt;&gt; 8 ) )
#define _ufp16p16toufp24p8(x)   ( (ufp24p8_t)  ((x)  &gt;&gt; 8 ) )
#define _ufp16p16toufp16p16(x)                  (x)
#define _ufp16p16toufp8p24(x)   ( (ufp8p24_t)  ((x)  &lt;&lt; 8 ) )

#define _fp8p24tofp8p8(x)       ( (fp8p8_t)    ((x)  &gt;&gt; 16) )
#define _fp8p24tofp24p8(x)      ( (fp24p8_t)   ((x)  &gt;&gt; 16) )
#define _fp8p24tofp16p16(x)     ( (fp16p16_t)  ((x)  &gt;&gt; 8 ) )
#define _fp8p24tofp8p24(x)                      (x)
#define _ufp8p24toufp8p8(x)     ( (ufp8p8_t)   ((x)  &gt;&gt; 16) )
#define _ufp8p24toufp24p8(x)    ( (ufp24p8_t)  ((x)  &gt;&gt; 16) )
#define _ufp8p24toufp16p16(x)   ( (ufp16p16_t) ((x)  &gt;&gt; 8 ) )
#define _ufp8p24toufp8p24(x)                    (x)

/* ------------------------------------------------------------------------- */

/* SIMPLE MATH */

/* multiplication (x*y) */

#define _mulfp8p8(x,y)    ( ( (int32_t)(x) *  (int32_t)(y)) &gt;&gt; 8  )
#define _mulfp24p8(x,y)   ( ( (int64_t)(x) *  (int64_t)(y)) &gt;&gt; 8  )
#define _mulfp16p16(x,y)  ( ( (int64_t)(x) *  (int64_t)(y)) &gt;&gt; 16 )
#define _mulfp8p24(x,y)   ( ( (int64_t)(x) *  (int64_t)(y)) &gt;&gt; 24 )
#define _mulufp8p8(x,y)   ( ((uint32_t)(x) * (uint32_t)(y)) &gt;&gt; 8  )
#define _mulufp24p8(x,y)  ( ((uint64_t)(x) * (uint64_t)(y)) &gt;&gt; 8  )
#define _mulufp16p16(x,y) ( ((uint64_t)(x) * (uint64_t)(y)) &gt;&gt; 16 )
#define _mulufp8p24(x,y)  ( ((uint64_t)(x) * (uint64_t)(y)) &gt;&gt; 24 )

/* division (x/y) */

#define _divfp8p8(x,y)    ( ( (int32_t)(x) &lt;&lt; 8 ) / (y) )
#define _divfp24p8(x,y)   ( ( (int64_t)(x) &lt;&lt; 8 ) / (y) )
#define _divfp16p16(x,y)  ( ( (int64_t)(x) &lt;&lt; 16) / (y) )
#define _divfp8p24(x,y)   ( ( (int64_t)(x) &lt;&lt; 24) / (y) )
#define _divufp8p8(x,y)   ( ((uint32_t)(x) &lt;&lt; 8 ) / (y) )
#define _divufp24p8(x,y)  ( ((uint64_t)(x) &lt;&lt; 8 ) / (y) )
#define _divufp16p16(x,y) ( ((uint64_t)(x) &lt;&lt; 16) / (y) )
#define _divufp8p24(x,y)  ( ((uint64_t)(x) &lt;&lt; 24) / (y) )

/* ------------------------------------------------------------------------- */

/* MORE ADVANCED MATH */

/* ------------------------------------------------------------------------- */

/* &gt;&gt;&gt; Square root &lt;&lt;&lt; */

/* I've tried numerous algorithms here (Newton, Knuth, Halleck, etc...) but
 * for any type larger than 8p8 they became way too slow (factor 15++ slower
 * than the FPU), so I have to resort to a simple binary search
 * convergence algorithm for now. At least it's only 3-11 times slower,
 * depending on the type chosen :/  It does tend to be less precise though
 * as x increases. Have to check how these algorithms perform on older
 * CPU's without a modern FPU.
 */

/* temporary variables */

static ufp8p8_t   _ufp8p8tmp,   _ufp8p8tmp2;
static ufp24p8_t  _ufp24p8tmp,  _ufp24p8tmp2;
static ufp16p16_t _ufp16p16tmp, _ufp16p16tmp2;
static ufp8p24_t  _ufp8p24tmp,  _ufp8p24tmp2;

#define _mid(a,b)           (a+((b-a)&gt;&gt;1))

#define _convergeufp8p8(a,b,x)    ( (_mulufp8p8(_mid(a,b),_mid(a,b))&lt;x)   ? \
                                       (a=_mid(a,b)):(b=_mid(a,b)) )
#define _convergeufp24p8(a,b,x)   ( (_mulufp24p8(_mid(a,b),_mid(a,b))&lt;x)  ? \
                                       (a=_mid(a,b)):(b=_mid(a,b)) )
#define _convergeufp16p16(a,b,x)  ( (_mulufp16p16(_mid(a,b),_mid(a,b))&lt;x) ? \
                                       (a=_mid(a,b)):(b=_mid(a,b)) )
#define _convergeufp8p24(a,b,x)   ( (_mulufp8p24(_mid(a,b),_mid(a,b))&lt;x)  ? \
                                       (a=_mid(a,b)):(b=_mid(a,b)) )

#define __sqrtufp8p8(a,b,x)   ( (x&gt;(4&lt;&lt;8)) ? (a=1&lt;&lt;8) &amp;&amp; (b=(x&gt;&gt;1)) \
                                           : ((a=0)||1) &amp;&amp; (b=x&lt;&lt;1) \
                              ) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              &amp;&amp; _convergeufp8p8(a,b,x) \
                              ? _mid(a,b) : 0

#define __sqrtufp24p8(a,b,x)  ( (x&gt;(4&lt;&lt;8)) ? (a=1&lt;&lt;8) &amp;&amp; (b=(x&gt;&gt;1)) \
                                           : ((a=0)||1) &amp;&amp; (b=x&lt;&lt;1) \
                              ) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              &amp;&amp; _convergeufp24p8(a,b,x) \
                              ? _mid(a,b) : 0

#define __sqrtufp16p16(a,b,x) ( (x&gt;(4&lt;&lt;16)) ? (a=1&lt;&lt;16) &amp;&amp; (b=(x&gt;&gt;1)) \
                                           : ((a=0)||1) &amp;&amp; (b=x&lt;&lt;1) \
                              ) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              &amp;&amp; _convergeufp16p16(a,b,x) \
                              ? _mid(a,b) : 0

#define __sqrtufp8p24(a,b,x) ( (x&gt;(4&lt;&lt;24)) ? (a=1&lt;&lt;24) &amp;&amp; (b=(x&gt;&gt;1)) \
                                           : ((a=0)||1) &amp;&amp; (b=x&lt;&lt;1) \
                              ) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              &amp;&amp; _convergeufp8p24(a,b,x) \
                              ? _mid(a,b) : 0

#define _sqrtufp8p8(x)      __sqrtufp8p8  (_ufp8p8tmp,   _ufp8p8tmp2,   x)
#define _sqrtufp24p8(x)     __sqrtufp24p8 (_ufp24p8tmp,  _ufp24p8tmp2,  x)
#define _sqrtufp16p16(x)    __sqrtufp16p16(_ufp16p16tmp, _ufp16p16tmp2, x)
#define _sqrtufp8p24(x)     __sqrtufp8p24 (_ufp8p24tmp,  _ufp8p24tmp2,  x)

#define _sqrtfp8p8(x)       (x&gt;0 ? _sqrtufp8p8(x)   : 0)
#define _sqrtfp24p8(x)      (x&gt;0 ? _sqrtufp24p8(x)  : 0)
#define _sqrtfp16p16(x)     (x&gt;0 ? _sqrtufp16p16(x) : 0)
#define _sqrtfp8p24(x)      (x&gt;0 ? _sqrtufp8p24(x)  : 0)

#define _sqrtufp8p8lut(x)   ( __genericufp8p8lut  (_ufp8p8sqrtlut_16,      \
                                                   _ufp8p8sqrtlut_256,   x ) )
#define _sqrtufp24p8lut(x)  ( __genericufp24p8lut (_ufp24p8sqrtlut_16,     \
                                                   _ufp24p8sqrtlut_256,    \
                                                   _ufp24p8sqrtlut_64k,    \
                                                   _ufp24p8sqrtlut_16m,  x ) )
#define _sqrtufp16p16lut(x) ( __genericufp16p16lut(_ufp16p16sqrtlut_16,    \
                                                   _ufp16p16sqrtlut_256,   \
                                                   _ufp16p16sqrtlut_64k, x ) )
#define _sqrtufp8p24lut(x)  ( __genericufp8p24lut (_ufp8p24sqrtlut_4,      \
                                                   _ufp8p24sqrtlut_16,     \
                                                   _ufp8p24sqrtlut_256,  x ) )

#define _sqrtfp8p8lut(x)    (x&gt;0 ? _sqrtufp8p8lut(x)   : 0)
#define _sqrtfp24p8lut(x)   (x&gt;0 ? _sqrtufp24p8lut(x)  : 0)
#define _sqrtfp16p16lut(x)  (x&gt;0 ? _sqrtufp16p16lut(x) : 0)
#define _sqrtfp8p24lut(x)   (x&gt;0 ? _sqrtufp8p24lut(x)  : 0)

/* &gt;&gt;&gt; Exponential function &lt;&lt;&lt; */

/* e^x for x&gt;=0 */

/* temporary variables */

static uint32_t _fp32_x2,  _fp32_x3,  _fp32_x4,  _fp32_x5,  _fp32_x6;
static uint64_t _fp64_x2,  _fp64_x3,  _fp64_x4,  _fp64_x5,  _fp64_x6,
                _fp64_x7,  _fp64_x8,  _fp64_x9,  _fp64_x10, _fp64_x11,
                _fp64_x12, _fp64_x13, _fp64_x14, _fp64_x15, _fp64_x16;

/* I cheat a little here by passing overflowed ufp8p8's to mul and div,
 * but they get cast to uint32_t anyway, so this gives a bit more precission.
 * However, it does _not_ use 64-bit (u)ints and that's intentional!
 * Precision is reasonable for 0 &lt; x &lt; 3 and starts to degrade after that.
 * x&gt;5 will soon start to overflow!
 *
 * All of them have problems when they reach zero, because some of the terms
 * won't fit in the type (i.e. 0.0001 becomes 0) and the expression is
 * false. That's why I add 1 to each term, so every expression evaluates
 * as true. 1 equals to 1/2^8, 1/2^16 and 1/2^24, depending on the type,
 * so the loss of precision is very limited.
 */

#define _expufp8p8(x)   (_fp32_x2 = _mulufp8p8(x       , x        )+1) &amp;&amp; \
                        (_fp32_x3 = _mulufp8p8(_fp32_x2, x        )+1) &amp;&amp; \
                        (_fp32_x4 = _mulufp8p8(_fp32_x2, _fp32_x2 )+1) &amp;&amp; \
                        (_fp32_x5 = _mulufp8p8(_fp32_x4, x        )+1) &amp;&amp; \
                        (_fp32_x6 = _mulufp8p8(_fp32_x4, _fp32_x2 )+1) ? \
                        ( 1&lt;&lt;8 ) + \
                        x + _divufp8p8(_fp32_x2, 2&lt;&lt;8 )   + \
                            _divufp8p8(_fp32_x3, 6&lt;&lt;8 )   + \
                            _divufp8p8(_fp32_x4, 24&lt;&lt;8 )  + \
                            _divufp8p8(_fp32_x5, 120&lt;&lt;8 ) + \
                            _divufp8p8(_fp32_x6, 720&lt;&lt;8 ) \
                        : (1&lt;&lt;8)

/* Same cheat for the next three macro's, but with uint64_t instead */

/* precision degrades after x = 9 or there about and overflows soon if x&gt;15 */

#define _expufp24p8(x)  (_fp64_x2  = _mulufp24p8(x       , x        )+1) &amp;&amp; \
                        (_fp64_x3  = _mulufp24p8(_fp64_x2, x        )+1) &amp;&amp; \
                        (_fp64_x4  = _mulufp24p8(_fp64_x2, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x5  = _mulufp24p8(_fp64_x3, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x6  = _mulufp24p8(_fp64_x3, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x7  = _mulufp24p8(_fp64_x4, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x8  = _mulufp24p8(_fp64_x4, _fp64_x4 )+1) &amp;&amp; \
                        (_fp64_x9  = _mulufp24p8(_fp64_x5, _fp64_x4 )+1) &amp;&amp; \
                        (_fp64_x10 = _mulufp24p8(_fp64_x5, _fp64_x5 )+1) &amp;&amp; \
                        (_fp64_x11 = _mulufp24p8(_fp64_x6, _fp64_x5 )+1) &amp;&amp; \
                        (_fp64_x12 = _mulufp24p8(_fp64_x6, _fp64_x6 )+1) &amp;&amp; \
                        (_fp64_x13 = _mulufp24p8(_fp64_x7, _fp64_x6 )+1) &amp;&amp; \
                        (_fp64_x14 = _mulufp24p8(_fp64_x7, _fp64_x7 )+1) &amp;&amp; \
                        (_fp64_x15 = _mulufp24p8(_fp64_x8, _fp64_x7 )+1) &amp;&amp; \
                        (_fp64_x16 = _mulufp24p8(_fp64_x8, _fp64_x8 )+1)  ? \
                        ( 1&lt;&lt;8 ) + \
                        x + \
                        _divufp24p8(_fp64_x2,  2&lt;&lt;8 )     + \
                        _divufp24p8(_fp64_x3,  6&lt;&lt;8 )     + \
                        _divufp24p8(_fp64_x4,  24&lt;&lt;8 )    + \
                        _divufp24p8(_fp64_x5,  120&lt;&lt;8 )   + \
                        _divufp24p8(_fp64_x6,  720&lt;&lt;8 )   + \
                        _divufp24p8(_fp64_x7,  5040&lt;&lt;8 )  + \
                        _divufp24p8(_fp64_x8,  (uint64_t) 40320&lt;&lt;8 )         +\
                        _divufp24p8(_fp64_x9,  (uint64_t) 362880L&lt;&lt;8 )       +\
                        _divufp24p8(_fp64_x10, (uint64_t) 3628800L&lt;&lt;8 )      +\
                        _divufp24p8(_fp64_x11, (uint64_t) 39916800L&lt;&lt;8 )     +\
                        _divufp24p8(_fp64_x12, (uint64_t) 479001600L&lt;&lt;8 )    +\
                        _divufp24p8(_fp64_x13, (uint64_t) 6227020800LL&lt;&lt;8 )  +\
                        _divufp24p8(_fp64_x14, (uint64_t) 87178291200LL&lt;&lt;8 ) +\
                        _divufp24p8(_fp64_x15, (uint64_t) 1307674368000LL&lt;&lt;8)+\
                        _divufp24p8(_fp64_x16, (uint64_t) 20922789888000LL&lt;&lt;8)\
                        : (1&lt;&lt;8)

/* best precision-to-value ratio since it's well balanced */

#define _expufp16p16(x) (_fp64_x2  = _mulufp16p16(x       , x        )+1) &amp;&amp; \
                        (_fp64_x3  = _mulufp16p16(_fp64_x2, x        )+1) &amp;&amp; \
                        (_fp64_x4  = _mulufp16p16(_fp64_x2, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x5  = _mulufp16p16(_fp64_x3, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x6  = _mulufp16p16(_fp64_x3, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x7  = _mulufp16p16(_fp64_x4, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x8  = _mulufp16p16(_fp64_x4, _fp64_x4 )+1) &amp;&amp; \
                        (_fp64_x9  = _mulufp16p16(_fp64_x5, _fp64_x4 )+1) &amp;&amp; \
                        (_fp64_x10 = _mulufp16p16(_fp64_x5, _fp64_x5 )+1)  ? \
                        ( 1&lt;&lt;16 ) + \
                        x + \
                        _divufp16p16(_fp64_x2,  2&lt;&lt;16 )     + \
                        _divufp16p16(_fp64_x3,  6&lt;&lt;16 )     + \
                        _divufp16p16(_fp64_x4,  24&lt;&lt;16 )    + \
                        _divufp16p16(_fp64_x5,  120&lt;&lt;16 )   + \
                        _divufp16p16(_fp64_x6,  720&lt;&lt;16 )   + \
                        _divufp16p16(_fp64_x7,  5040&lt;&lt;16 )  + \
                        _divufp16p16(_fp64_x8,  (uint64_t) 40320&lt;&lt;16 )    + \
                        _divufp16p16(_fp64_x9,  (uint64_t) 362880L&lt;&lt;16 )  + \
                        _divufp16p16(_fp64_x10, (uint64_t) 3628800L&lt;&lt;16 )   \
                        : (1&lt;&lt;16)

/* upper limit of x lowered compared to expfp8p8, so the precision of
 * the fraction is somewhat better, but it overflows sooner if x increases  */

#define _expufp8p24(x)  (_fp64_x2  = _mulufp8p24(x       , x        )+1) &amp;&amp; \
                        (_fp64_x3  = _mulufp8p24(_fp64_x2, x        )+1) &amp;&amp; \
                        (_fp64_x4  = _mulufp8p24(_fp64_x2, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x5  = _mulufp8p24(_fp64_x3, _fp64_x2 )+1) &amp;&amp; \
                        (_fp64_x6  = _mulufp8p24(_fp64_x3, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x7  = _mulufp8p24(_fp64_x4, _fp64_x3 )+1) &amp;&amp; \
                        (_fp64_x8  = _mulufp8p24(_fp64_x4, _fp64_x4 )+1)  ? \
                        ( 1&lt;&lt;24 ) + \
                        x + \
                        _divufp8p24(_fp64_x2,  2&lt;&lt;24 )     + \
                        _divufp8p24(_fp64_x3,  6&lt;&lt;24 )     + \
                        _divufp8p24(_fp64_x4,  24&lt;&lt;24 )    + \
                        _divufp8p24(_fp64_x5,  120&lt;&lt;24 )   + \
                        _divufp8p24(_fp64_x6,  720&lt;&lt;24 )   +  \
                        _divufp8p24(_fp64_x7,  5040&lt;&lt;24 )  + \
                        _divufp8p24(_fp64_x8,  (uint64_t) 40320&lt;&lt;24 ) \
                        : (1&lt;&lt;24)

#define _expfp8p8(x)    _expufp8p8(x)
#define _expfp24p8(x)   _expufp24p8(x)
#define _expfp16p16(x)  _expufp16p16(x)
#define _expfp8p24(x)   _expufp8p24(x)

#define _expufp8p8lut(x)   ( __genericufp8p8lut  (_ufp8p8explut_16,      \
                                                  _ufp8p8explut_256,   x ) )
#define _expufp24p8lut(x)  ( __genericufp24p8lut (_ufp24p8explut_16,     \
                                                  _ufp24p8explut_256,    \
                                                  _ufp24p8explut_64k,    \
                                                  _ufp24p8explut_16m,  x ) )
#define _expufp16p16lut(x) ( __genericufp16p16lut(_ufp16p16explut_16,    \
                                                  _ufp16p16explut_256,   \
                                                  _ufp16p16explut_64k, x ) )
#define _expufp8p24lut(x)  ( __genericufp8p24lut (_ufp8p24explut_4,      \
                                                  _ufp8p24explut_16,     \
                                                  _ufp8p24explut_256,  x ) )

#define _expfp8p8lut(x)    (x&gt;0 ? _expufp8p8lut(x)   : 1&lt;&lt;8)
#define _expfp24p8lut(x)   (x&gt;0 ? _expufp24p8lut(x)  : 1&lt;&lt;8)
#define _expfp16p16lut(x)  (x&gt;0 ? _expufp16p16lut(x) : 1&lt;&lt;16)
#define _expfp8p24lut(x)   (x&gt;0 ? _expufp8p24lut(x)  : 1&lt;&lt;24)

/* &gt;&gt;&gt; Natural logarithm &lt;&lt;&lt; */

/* ln x or log_e x */
/* f(x)=ln(x) for x&gt;=1
 */

#define __lnufp8p8(a)   (a&gt;=1&lt;&lt;8) ? ( /* x&gt;= 1 */ \
      (         (a&lt;=1&lt;&lt;9)?     0:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 177:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 355:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 532:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 710:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 887:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1065:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1242:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1420:0)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 7))?0:(a=_mulufp8p8(a,171))?104:104)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 6))?0:(a=_mulufp8p8(a,205))?57:57)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 5))?0:(a=_mulufp8p8(a,228))?30:30)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 4))?0:(a=_mulufp8p8(a,241))?16:16)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 3))?0:(a=_mulufp8p8(a,248))?8:8)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 2))?0:(a=_mulufp8p8(a,252))?4:4)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 1))?0:(a=_mulufp8p8(a,254))?2:2)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 0))?0:(a=_mulufp8p8(a,255))?1:1)\
      ) /* done */ \
      : /* x&lt;1 */ itofp8p8(0)

#define __lnufp24p8(a)   (a&gt;=1&lt;&lt;8) ? ( /* x&gt;= 1 */ \
      (         (a&lt;=1&lt;&lt;9)?   0:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 177:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 355:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 532:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 710:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)? 887:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1065:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1242:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1420:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1597:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1774:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?1952:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?2129:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?2307:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?2484:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?2662:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?2839:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3017:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3194:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3371:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3549:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3726:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?3904:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?4081:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;9)?4259:0)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 7))?0:(a=_mulufp24p8(a,171))?104:104)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 6))?0:(a=_mulufp24p8(a,205))?57:57)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 5))?0:(a=_mulufp24p8(a,228))?30:30)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 4))?0:(a=_mulufp24p8(a,241))?16:16)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 3))?0:(a=_mulufp24p8(a,248))?8:8)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 2))?0:(a=_mulufp24p8(a,252))?4:4)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 1))?0:(a=_mulufp24p8(a,254))?2:2)\
      +((a&lt;=(1&lt;&lt;8)+(1&lt;&lt; 0))?0:(a=_mulufp24p8(a,255))?1:1)\
      ) /* done */ \
      : /* x&lt;1 */ itofp24p8(0)

#define __lnufp16p16(a)   (a&gt;=1&lt;&lt;16) ? ( /* x&gt;= 1 */ \
      (         (a&lt;=1&lt;&lt;17)?     0:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)? 45426:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)? 90852:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?136278:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?181704:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?227130:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?272557:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?317983:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?363409:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?408835:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?454261:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?499687:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?545113:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?590539:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?635965:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?681391:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;17)?726818:0)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;15))?0:(a=_mulufp16p16(a,43691))?26573:26573)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;14))?0:(a=_mulufp16p16(a,52429))?14624:14624)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;13))?0:(a=_mulufp16p16(a,58254))?7719:7719)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;12))?0:(a=_mulufp16p16(a,61681))?3973:3973)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;11))?0:(a=_mulufp16p16(a,63550))?2017:2017)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt;10))?0:(a=_mulufp16p16(a,64528))?1016:1016)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 9))?0:(a=_mulufp16p16(a,65028))?510:510)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 8))?0:(a=_mulufp16p16(a,65281))?256:256)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 7))?0:(a=_mulufp16p16(a,65408))?128:128)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 6))?0:(a=_mulufp16p16(a,65472))?64:64)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 5))?0:(a=_mulufp16p16(a,65504))?32:32)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 4))?0:(a=_mulufp16p16(a,65520))?16:16)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 3))?0:(a=_mulufp16p16(a,65528))?8:8)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 2))?0:(a=_mulufp16p16(a,65532))?4:4)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 1))?0:(a=_mulufp16p16(a,65534))?2:2)\
      +((a&lt;=(1&lt;&lt;16)+(1&lt;&lt; 0))?0:(a=_mulufp16p16(a,65535))?1:1)\
      ) /* done */ \
      : /* x&lt;1 */ itofp16p16(0)

#define __lnufp8p24(a)   (a&gt;=1&lt;&lt;24) ? ( /* x&gt;= 1 */ \
      (         (a&lt;=1&lt;&lt;25)?     0:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?11629080:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?23258160:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?34887240:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?46516320:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?58145400:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?69774480:\
       (a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?81403560:(a&gt;&gt;=1)&amp;&amp;(a&lt;=1&lt;&lt;25)?93032640:0)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;23))?0:(a=_mulufp8p24(a,11184811))?6802576:6802576)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;22))?0:(a=_mulufp8p24(a,13421773))?3743728:3743728)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;21))?0:(a=_mulufp8p24(a,14913081))?1976071:1976071)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;20))?0:(a=_mulufp8p24(a,15790321))?1017112:1017112)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;19))?0:(a=_mulufp8p24(a,16268816))?516263:516263)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;18))?0:(a=_mulufp8p24(a,16519105))?260117:260117)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;17))?0:(a=_mulufp8p24(a,16647160))?130563:130563)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;16))?0:(a=_mulufp8p24(a,16711935))?65408:65408)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;15))?0:(a=_mulufp8p24(a,16744512))?32736:32736)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;14))?0:(a=_mulufp8p24(a,16760848))?16376:16376)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;13))?0:(a=_mulufp8p24(a,16769028))?8190:8190)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;12))?0:(a=_mulufp8p24(a,16773121))?4096:4096)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;11))?0:(a=_mulufp8p24(a,16775168))?2048:2048)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt;10))?0:(a=_mulufp8p24(a,16776192))?1024:1024)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 9))?0:(a=_mulufp8p24(a,16776704))?512:512)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 8))?0:(a=_mulufp8p24(a,16776960))?256:256)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 7))?0:(a=_mulufp8p24(a,16777088))?128:128)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 6))?0:(a=_mulufp8p24(a,16777152))?64:64)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 5))?0:(a=_mulufp8p24(a,16777184))?32:32)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 4))?0:(a=_mulufp8p24(a,16777200))?16:16)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 3))?0:(a=_mulufp8p24(a,16777208))?8:8)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 2))?0:(a=_mulufp8p24(a,16777212))?4:4)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 1))?0:(a=_mulufp8p24(a,16777214))?2:2)\
      +((a&lt;=(1&lt;&lt;24)+(1&lt;&lt; 0))?0:(a=_mulufp8p24(a,16777216))?1:1)\
      ) /* done */ \
      : /* x&lt;1 */ itofp8p24(0)

#define _lnufp8p8(a)    (_ufp8p8tmp=a)   ? (__lnufp8p8(_ufp8p8tmp)) \
                                         : (__lnufp8p8(_ufp8p8tmp))
#define _lnufp24p8(a)   (_ufp24p8tmp=a)  ? (__lnufp24p8(_ufp24p8tmp)) \
                                         : (__lnufp24p8(_ufp24p8tmp))
#define _lnufp16p16(a)  (_ufp16p16tmp=a) ? (__lnufp16p16(_ufp16p16tmp)) \
                                         : (__lnufp16p16(_ufp16p16tmp))
#define _lnufp8p24(a)   (_ufp8p24tmp=a)  ? (__lnufp8p24(_ufp8p24tmp)) \
                                         : (__lnufp8p24(_ufp8p24tmp))

#define _lnfp8p8(a)      _lnufp8p8(a)
#define _lnfp24p8(a)     _lnufp24p8(a)
#define _lnfp16p16(a)    _lnufp16p16(a)
#define _lnfp8p24(a)     _lnufp8p24(a)

#define _lnufp8p8lut(x)   ( __genericufp8p8lut  (_ufp8p8lnlut_16,      \
                                                 _ufp8p8lnlut_256,   x ) )
#define _lnufp24p8lut(x)  ( __genericufp24p8lut (_ufp24p8lnlut_16,     \
                                                 _ufp24p8lnlut_256,    \
                                                 _ufp24p8lnlut_64k,    \
                                                 _ufp24p8lnlut_16m,  x ) )
#define _lnufp16p16lut(x) ( __genericufp16p16lut(_ufp16p16lnlut_16,    \
                                                 _ufp16p16lnlut_256,   \
                                                 _ufp16p16lnlut_64k, x ) )
#define _lnufp8p24lut(x)  ( __genericufp8p24lut (_ufp8p24lnlut_4,      \
                                                 _ufp8p24lnlut_16,     \
                                                 _ufp8p24lnlut_256,  x ) )

#define _lnfp8p8lut(x)    (x&gt;(1&lt;&lt;8)  ? _lnufp8p8lut(x)   : 0)
#define _lnfp24p8lut(x)   (x&gt;(1&lt;&lt;8)  ? _lnufp24p8lut(x)  : 0)
#define _lnfp16p16lut(x)  (x&gt;(1&lt;&lt;16) ? _lnufp16p16lut(x) : 0)
#define _lnfp8p24lut(x)   (x&gt;(1&lt;&lt;24) ? _lnufp8p24lut(x)  : 0)

/* &gt;&gt;&gt; Power function &lt;&lt;&lt; */

/* x^y */

#define _powufp8p8(x,y)   ((_ufp8p8tmp2   = _mulufp8p8 (y, lnufp8p8(x)  )) ? \
                                           expufp8p8  (_ufp8p8tmp2) : 1&lt;&lt;8)
#define _powufp24p8(x,y)  ((_ufp24p8tmp2  = _mulufp24p8(y, lnufp24p8(x)  )) ? \
                                           expufp24p8 (_ufp24p8tmp2) : 1&lt;&lt;24)
#define _powufp16p16(x,y) ((_ufp16p16tmp2 = _mulufp16p16(y, lnufp16p16(x)  ))?\
                                           expufp16p16 (_ufp16p16tmp2) : 1&lt;&lt;16)
#define _powufp8p24(x,y)  ((_ufp8p24tmp2  = _mulufp8p24 (y, lnufp8p24(x)  )) ?\
                                           expufp8p24  (_ufp8p24tmp2) : 1&lt;&lt;8)

#define _powfp8p8(x,y)   _powufp8p8(x,y)
#define _powfp24p8(x,y)  _powufp24p8(x,y)
#define _powfp16p16(x,y) _powufp16p16(x,y)
#define _powfp8p24(x,y)  _powufp8p24(x,y)

/* ------------------------------------------------------------------------- */

/* Generic LUT macro's, used for sqrt, exp and ln in LUT mode 
 *
 * Use linear interpolation for values that don't map exactly
 */

#define __genericufp8p8lut(lut16, lut256, x) \
            (x&lt;16&lt;&lt;8)    ? lut16[x&gt;&gt;5] +                              \
                           _mulufp8p8( ((x&lt;&lt;3)&amp;0x0ff),                 \
                                      (lut16[(x&gt;&gt;5)+1] - lut16[x&gt;&gt;5]) \
                                    ) \
                         : lut256[((x&gt;&gt;8)-16)&gt;&gt;1] + \
                           _mulufp8p8( ((x&gt;&gt;1)&amp;0x0ff),       \
                                      (lut256[(((x&gt;&gt;8)-16)&gt;&gt;1)+1] - \
                                       lut256[ ((x&gt;&gt;8)-16)&gt;&gt;1   ])  \
                                    )

#define __genericufp24p8lut(lut16, lut256, lut64k, lut16m, x) \
            (x&lt;16&lt;&lt;8)    ? lut16[x&gt;&gt;5] + \
                           _mulufp24p8( ((x&lt;&lt;3)&amp;0x0ff), \
                                       (lut16[(x&gt;&gt;5)+1] - lut16[x&gt;&gt;5]) \
                                     ) \
          : (x&lt;256&lt;&lt;8)   ? lut256[((x&gt;&gt;8)-16)&gt;&gt;1] +\
                           _mulufp24p8( ((x&gt;&gt;1)&amp;0x0ff), \
                                       (lut256[(((x&gt;&gt;8)-16)&gt;&gt;1)+1] - \
                                        lut256[ ((x&gt;&gt;8)-16)&gt;&gt;1   ])  \
                                     ) \
          : (x&lt;65536&lt;&lt;8) ? lut64k[((x&gt;&gt;8)-256)&gt;&gt;9] + \
                           _mulufp24p8( (((x-(256&lt;&lt;8))&gt;&gt;9)&amp;0x0ff), \
                                       (lut64k[(((x&gt;&gt;8)-256)&gt;&gt;9)+1] - \
                                        lut64k[ ((x&gt;&gt;8)-256)&gt;&gt;9   ])  \
                                     ) \
                         : lut16m[((x&gt;&gt;8)-65536)&gt;&gt;17] + \
                           _mulufp24p8( (((x-(65536&lt;&lt;8))&gt;&gt;17)&amp;0x0ff), \
                                       (lut16m[(((x&gt;&gt;8)-65536)&gt;&gt;17)+1] - \
                                        lut16m[ ((x&gt;&gt;8)-65536)&gt;&gt;17   ])  \
                                     )

#define __genericufp16p16lut(lut16, lut256, lut64k, x) \
            (x&lt;16&lt;&lt;16)   ? lut16[x&gt;&gt;13] + \
                           _mulufp16p16( ((x&lt;&lt;3)&amp;0x0ffff),     \
                                        (lut16[(x&gt;&gt;13)+1] -   \
                                         lut16[(x&gt;&gt;13)  ]) \
                                       ) \
          : (x&lt;256&lt;&lt;16)  ? lut256[((x&gt;&gt;16)-16)&gt;&gt;1] + \
                           _mulufp16p16(  ((x&gt;&gt;1)&amp;0x0ffff), \
                                         (lut256[(((x&gt;&gt;16)-16)&gt;&gt;1)+1] - \
                                          lut256[ ((x&gt;&gt;16)-16)&gt;&gt;1   ]) \
                                       ) \
                         : lut64k[((x&gt;&gt;16)-256)&gt;&gt;9] + \
                           _mulufp16p16(  (((x-(256&lt;&lt;16))&gt;&gt;9)&amp;0x0ffff), \
                                         (lut64k[(((x&gt;&gt;16)-256)&gt;&gt;9)+1] - \
                                          lut64k[ ((x&gt;&gt;16)-256)&gt;&gt;9   ]) \
                                       )

#define __genericufp8p24lut(lut4, lut16, lut256, x) \
            (x&lt;4&lt;&lt;24)    ? lut4[x&gt;&gt;19]  + \
                           _mulufp8p24( ((x&lt;&lt;5)&amp;0x0ffffff),     \
                                       (lut4[(x&gt;&gt;19)+1] -       \
                                        lut4[(x&gt;&gt;19)  ])        \
                                      ) \
          : (x&lt;16&lt;&lt;24)   ? lut16[x&gt;&gt;21] + \
                           _mulufp8p24( ((x&lt;&lt;3)&amp;0x0ffffff),     \
                                       (lut16[(x&gt;&gt;21)+1] -      \
                                        lut16[(x&gt;&gt;21)  ])       \
                                      ) \
                         : lut256[((x&gt;&gt;24)-16)&gt;&gt;1] + \
                           _mulufp8p24( ((x&gt;&gt;1)&amp;0x0ffffff),     \
                                       (lut256[(((x&gt;&gt;24)-16)&gt;&gt;1)+1] - \
                                        lut256[(((x&gt;&gt;24)-16)&gt;&gt;1)  ]) \
                                      )

/* ------------------------------------------------------------------------- */

/* MAKE COMPILER WARNINGS GO AWAY */

/* This makes sure the compiler doesn't warn you about blabla defined but
 * not used. It does add a little code to your program though. If you don't
 * like that and really care about code size (maybe for embedded systems for
 * example), you can define __FPM_LEAVE_WARNINGS__ before including this file,
 * although stripping the binary will remove this code on most systems anyway.
 *
 * Funny though, ICC starts complaining about a function that's never
 * called :-) But ICC complains about anything, like &quot;warning: '=' where
 * '==' may have been intended&quot;. MAY HAVE BEEN??? STFU!
 */

/* Not sure if I keep this &quot;function&quot;. About every compiler either complains
 * about unused variables or about a function that never gets called,
 * depending on the optimization level and if this function is here or not.
 * Maybe change it into some &quot;init&quot; function that has to be called by
 * the program that uses this macro lib?? Have to think about it.
 */

#ifndef __FPM_LEAVE_WARNINGS___
static void __fixed_point_math_make_compiler_warnings_go_away(void)
{
    _sqrtufp8p8(1);
    _sqrtufp24p8(1);
    _sqrtufp16p16(1);
    _sqrtufp8p24(1);
    _expufp8p8(1);
    _expufp24p8(1);
}
#endif

/* ------------------------------------------------------------------------- */

#endif

/* ------------------------------------------------------------------------- */



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000080.html">[fpm-cvslog] fpm/include - New directory
</A></li>
	<LI>Next message: <A HREF="000082.html">[fpm-cvslog] fpm/misc - New directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81">[ date ]</a>
              <a href="thread.html#81">[ thread ]</a>
              <a href="subject.html#81">[ subject ]</a>
              <a href="author.html#81">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fpm-cvslog">More information about the fpm-cvslog
mailing list</a><br>
</body></html>
